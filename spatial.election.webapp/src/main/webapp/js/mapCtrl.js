

function mapCtrl($scope, d3) {
	$scope.testmap = "Hallo";
	window.xyz = d3;
	
	var wkrs = getWkrsData();
	
	/* visualization */
	var
	width = 800,
	height = 600,
	vis = d3.select("body").append("svg").attr("width", width).attr("height", height),
	allBaseLines = [],
	scaleX = d3.scale.linear().domain([ -216000, -175000 ]).range([ 0, width ]),
	scaleY = d3.scale.linear().domain([ 6363000, 6399000 ]).range([ height, 0 ]),
	color = d3.scale.category10();

	vis.selectAll("polygon").data(wkrs).enter().append("polygon")
		.attr("points",
			function(d) {
				return d.points.map(function(d) {
					return [ scaleX(d.x), scaleY(d.y) ].join(",");
				}).join(" ");
			})

		.attr("fill", function(d) {
			return color(d.wkr_name)
		}).
		attr("stroke", "#666")
		.attr("stroke-width", 2);

	// add legend   
	var legend = vis.append("g")
		.attr("class", "legend")
		.attr("height", 100)
		.attr("width", 100)
		.attr('transform', 'translate(10,20)');

	legend.selectAll('rect').data(wkrs).enter().append("rect")
		.attr("x", 40).attr("y", function(d, i) {
			return i * 20;
		})
		.attr("width", 10)
		.attr("height", 10)
		.style("fill",
			function(d) {
				return color(d.wkr_name);
			});

	legend.selectAll('text').data(wkrs).enter().append("text")
		.attr("x", 55)
		.attr("y", function(d, i) {
			return i * 20 + 10;
		})
		.text(function(d) {
			return d.wkr_name + " (#" + d.wkr_nr + ")";
		});
}


function getWkrsData()
{
	var wkrs = [{
	    "gid": 100,
	        "wkr_nr": 100,
	        "wkr_name": "Rheinisch-Bergischer Kreis",
	        "land_nr": "05",
	        "land_name": "Nordrhein-Westfalen",
	        "jsonRepresentation": "{\"type\":\"MultiPolygon\",\"coordinates\":[[[[-193645.125,6396676],[-193198.781199999,6396440],[-192719.75,6396570],[-192005.531199999,6396512.5],[-191737.421899997,6396361.5],[-191576.234399997,6395913.5],[-191406.484399997,6395218],[-190846.890600003,6395004],[-190759.015600003,6395074.5],[-190618.1875,6394781],[-190654.156199999,6393454],[-190578.406199999,6392562],[-190573.8125,6391677],[-190141.859399997,6390956.5],[-189890.078100003,6390808],[-189448.968699999,6390700.5],[-188891.375,6390422],[-189786,6389186],[-189998.9375,6388858],[-190110,6388564],[-190323.906199999,6388494],[-190521.171899997,6388343.5],[-190618.921899997,6388183.5],[-190581.6875,6387824.5],[-190262.8125,6387516.5],[-189959.593699999,6387633],[-189320.171899997,6387470],[-189250.375,6387025],[-188940.078100003,6386440],[-188322.609399997,6386516.5],[-188258.546899997,6386582],[-188261.875,6386971],[-188172.9375,6387244.5],[-188015.75,6387380.5],[-187723.718699999,6387521],[-187048.3125,6386696],[-186774.656199999,6386752],[-186151.890600003,6386586.5],[-186153.515600003,6386520.5],[-186533.5625,6386228],[-186633.921899997,6385592.5],[-187281.171899997,6384899],[-187431.984399997,6384641.5],[-186915.484399997,6384082],[-186999.031199999,6384035.5],[-187837.1875,6382720.5],[-188288.171899997,6381795.5],[-188487.140600003,6381719.5],[-188824.375,6381717.5],[-188850.453100003,6381868],[-188961.031199999,6381973],[-189713.5625,6382374],[-190447.078100003,6381874],[-190543.546899997,6381751.5],[-190545.453100003,6381615],[-190441.781199999,6381355.5],[-190242.484399997,6381331.5],[-190205.093699999,6381155],[-190239.296899997,6380995],[-190631.531199999,6380391.5],[-190608.140600003,6379870],[-190409.296899997,6379682],[-190497.6875,6379357.5],[-190676,6379082],[-191048.390600003,6378710.5],[-192118.5,6377963],[-192656.5,6377416],[-192572.453100003,6377232.5],[-192443.843699999,6377150.5],[-192313.734399997,6377169.5],[-192151.5625,6377102.5],[-191561.781199999,6376666.5],[-191139.75,6376094],[-190465.781199999,6375600],[-190178.781199999,6375717.5],[-190401.3125,6375894],[-190171.593699999,6376235.5],[-190108.140600003,6376262],[-189399.890600003,6376353],[-189225.343699999,6376196],[-188814.234399997,6376010.5],[-188287.046899997,6375936.5],[-187950.765600003,6376196.5],[-187540.6875,6376305.5],[-187330.3125,6376200],[-186852.906199999,6375633.5],[-187274.078100003,6375174.5],[-187360.296899997,6374711],[-187309.078100003,6374678],[-186646.343699999,6375086],[-186496.265600003,6375017],[-186354.406199999,6374820.5],[-186166.281199999,6374320.5],[-186057.468699999,6373667.5],[-185584.156199999,6373173],[-185477.140600003,6373136],[-184669.734399997,6373794.5],[-183244.828100003,6373970],[-182959.531199999,6373624],[-182510.421899997,6372942.5],[-182874.953100003,6372866],[-182877.484399997,6372134],[-183386.75,6371347],[-183504.375,6371259],[-183857.5,6371259],[-184453.5625,6371340.5],[-184801.906199999,6371497.5],[-185091.859399997,6371372.5],[-185427.421899997,6370316],[-185345.156199999,6370214.5],[-185386.875,6370086.5],[-185660.765600003,6369575.5],[-185945.75,6369247],[-186242.546899997,6369046],[-186637.4375,6368867.5],[-187041.015600003,6368809],[-187657.328100003,6369167],[-187701.343699999,6369305],[-188156.953100003,6369366.5],[-188740.328100003,6368835.5],[-189009.343699999,6368690],[-189045.906199999,6368772],[-189106.9375,6368772.5],[-189347.140600003,6368439.5],[-189530.171899997,6368421.5],[-191271.671899997,6368955],[-191496.8125,6369271.5],[-191499.265600003,6369411],[-191802.9375,6369824],[-192966.625,6370814],[-193204.359399997,6370968],[-193305.625,6370762],[-193678.859399997,6370558],[-193978.765600003,6370167],[-194232.203100003,6369475],[-194290.218699999,6368652.5],[-194710.765600003,6367974.5],[-195546.796899997,6367208],[-195895.828100003,6367063.5],[-196410.125,6366496.5],[-196487.843699999,6366304.5],[-196420.828100003,6366254],[-196382.921899997,6365902],[-196995.625,6365439],[-197061.343699999,6365334],[-196956.3125,6365131.5],[-197236.078100003,6365028],[-197263.9375,6365087.5],[-197839.468699999,6365113.5],[-198542.156199999,6364844],[-198841.968699999,6364602],[-199362.796899997,6364554],[-199603.843699999,6364392],[-199444.046899997,6364642.5],[-199441.656199999,6364732.5],[-199647.406199999,6365152.5],[-200079.453100003,6365137],[-200152.625,6365171.5],[-200830.703100003,6365695],[-201139.593699999,6366063],[-201149.093699999,6366238],[-200873.515600003,6366706],[-200866.390600003,6366911],[-200987.1875,6368093],[-201194.781199999,6368727.5],[-200967.093699999,6369216],[-200873.421899997,6369706.5],[-200918.093699999,6369887.5],[-200900.296899997,6370150],[-200790.75,6370306],[-200764.109399997,6370621],[-200975.296899997,6371198.5],[-200751.390600003,6371673.5],[-200350.921899997,6372814.5],[-200287.781199999,6373060],[-200337.203100003,6373237],[-200601.265600003,6373311.5],[-201226.265600003,6372967.5],[-202669.328100003,6372941.5],[-203385.328100003,6373573],[-203553.968699999,6374040.5],[-203883.828100003,6374326.5],[-204398.5625,6374676],[-203957.578100003,6375099.5],[-203482.046899997,6375436],[-203291.4375,6375781.5],[-203471.265600003,6377234.5],[-203535.156199999,6377568],[-203614.203100003,6377728.5],[-204689.125,6378147.5],[-205482.875,6378255.5],[-205626.031199999,6378718.5],[-205081.968699999,6379441],[-204948.968699999,6379495.5],[-204912.109399997,6379603],[-205339.953100003,6380105],[-205861.515600003,6380899.5],[-205347.140600003,6381315.5],[-205377.656199999,6381472],[-204572.796899997,6382377],[-203761.703100003,6382211],[-203632.640600003,6382293.5],[-203231.859399997,6382737],[-203490,6383250.5],[-203166.609399997,6383559],[-202990.515600003,6383816.5],[-203177.781199999,6384024.5],[-203218.828100003,6384906],[-202450.531199999,6385438.5],[-201866.281199999,6385732],[-202031.531199999,6386005],[-202153.140600003,6386086.5],[-201961.109399997,6386324],[-202886.421899997,6386602],[-204549.218699999,6386748.5],[-205146.8125,6387037],[-205733.734399997,6387760],[-205859.515600003,6388008.5],[-205347.359399997,6388747],[-204896.359399997,6389120],[-204740.484399997,6389364.5],[-204716.640600003,6389944.5],[-204644.265600003,6390112],[-204849.015600003,6390068],[-205810.718699999,6390077],[-206625.203100003,6390139.5],[-206945.265600003,6390095],[-207614.468699999,6389876.5],[-207700.203100003,6389707.5],[-207622.625,6389635],[-207669.031199999,6389462.5],[-208620.703100003,6388846.5],[-209158.6875,6388581],[-209711.609399997,6388926.5],[-210608.718699999,6389750.5],[-210549.015600003,6391582],[-210446.281199999,6391778.5],[-210173.515600003,6391900.5],[-209848.609399997,6392309.5],[-209850.484399997,6392909.5],[-209447.734399997,6393236.5],[-208837.8125,6393298.5],[-208275.6875,6393792.5],[-208094.6875,6393887.5],[-207182.546899997,6394149],[-206670.375,6394152],[-206554.359399997,6394114.5],[-206205.359399997,6393716.5],[-205871.875,6393405.5],[-205666.078100003,6393285],[-205550.75,6393285.5],[-205326.828100003,6393557.5],[-204478.406199999,6393379],[-204264.671899997,6393542.5],[-204291.656199999,6393855.5],[-204424.828100003,6394234.5],[-204321.578100003,6394482],[-203818.578100003,6394675],[-203478.765600003,6394301.5],[-202978.625,6394134],[-202900.781199999,6394186],[-202920.578100003,6394530],[-202885.75,6394664],[-202833.640600003,6394684.5],[-201915.921899997,6394524.5],[-201373.031199999,6393966.5],[-201359.406199999,6393661],[-201426.671899997,6393343.5],[-201541.531199999,6393136],[-201316.218699999,6392860],[-200630.265600003,6392467.5],[-200132.093699999,6392347],[-199530.718699999,6392293.5],[-198919.406199999,6392395.5],[-198728.718699999,6392498.5],[-197572.593699999,6392950.5],[-197524.703100003,6393371],[-198077.296899997,6393392],[-198235.125,6393498],[-198502.515600003,6393970.5],[-198148.6875,6394350.5],[-197774.453100003,6394535.5],[-197936.25,6395036.5],[-198181.343699999,6395459.5],[-198114.046899997,6396015.5],[-197969.031199999,6396198.5],[-197600.359399997,6396060.5],[-197004.796899997,6396102.5],[-196847.265600003,6396153],[-196646.703100003,6396414],[-196095.8125,6396205.5],[-195818.375,6395844],[-195740.578100003,6395830],[-195590.765600003,6395908],[-195424.609399997,6396185],[-195237.765600003,6396364.5],[-194322.0625,6396829.5],[-194116.390600003,6396854],[-193645.125,6396676]]]]}"
	}]


	for (j = 0; j < wkrs.length; j++) {
	    wkrs[j].points = [];
	    var coods = eval("(" + wkrs[0].jsonRepresentation + ")").coordinates[0][0];
	    for (i = 0; i < coods.length; i++) {
	        wkrs[j].points[i] = {
	            "x": coods[i][0],
	            "y": coods[i][1]
	        };
	    }
	}
	
	return wkrs;

}